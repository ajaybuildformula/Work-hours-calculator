import { useState } from "react";
import { Input } from "../components/ui/Input";
import { Button } from "../components/ui/Button";
import { Card, CardContent } from "../components/ui/Card";
import "../styles/globle.css";

export default function Home() {
  const [inTime, setInTime] = useState("");
  const [breaks, setBreaks] = useState([{ start: "", end: "" }]);
  const [result, setResult] = useState("");
  const [errors, setErrors] = useState({});

  const handleBreakChange = (index, field, value) => {
    const updatedBreaks = [...breaks];
    updatedBreaks[index][field] = value;
    setBreaks(updatedBreaks);
  };

  const addBreak = () => setBreaks([...breaks, { start: "", end: "" }]);

  const removeBreak = (index) => {
    const updatedBreaks = breaks.filter((_, i) => i !== index);
    setBreaks(updatedBreaks);
    setTimeout(() => {
      calculateEndTime(updatedBreaks);
    }, 0);
  };

  const validate = () => {
    const newErrors = {};

    if (!inTime) newErrors.inTime = "In Time is required";

    breaks.forEach((b, i) => {
      if (!b.start) {
        newErrors[`break${i}_start`] = `Required`;
      }
      if (!b.end) {
        newErrors[`break${i}_end`] = `Required`;
      }
    });

    setErrors(newErrors);
    return Object.keys(newErrors).length === 0;
  };

  const parseTimeToMinutes = (timeStr) => {
    const [hours, minutes] = timeStr.split(":").map(Number);
    return hours * 60 + minutes;
  };

  const calculateEndTime = (breaksData = breaks) => {
    if (!validate()) return;

    const inMinutes = parseTimeToMinutes(inTime);
    const breakMinutes = breaksData.reduce((total, b) => {
      if (!b.start || !b.end) return total;
      const start = parseTimeToMinutes(b.start);
      const end = parseTimeToMinutes(b.end);
      return total + Math.max(0, end - start);
    }, 0);

    const totalMinutes = 615 + breakMinutes;
    const endMinutes = inMinutes + totalMinutes;

    const hours = Math.floor(endMinutes / 60) % 24;
    const minutes = (endMinutes % 60).toString().padStart(2, "0");
    const period = hours >= 12 ? "PM" : "AM";
    const displayHours = hours % 12 || 12;

    setResult(`You can leave at ${displayHours}:${minutes} ${period}`);
  };

  return (
    <div className="home-wrapper">
      <svg
        xmlns="http://www.w3.org/2000/svg"
        width="165"
        height="26"
        viewBox="0 0 165 26"
        fill="none"
      >
        <g clip-path="url(#clip0_7311_369990)">
          <path
            d="M0.00390625 10.2253V14.1565C1.653 13.8577 3.1045 15.7893 4.58772 17.3686V6.21875L0.00390625 10.2253Z"
            fill="#2A62D3"
          />
          <path
            d="M0.00390625 4.00654V8.67152L4.58772 4.66498V0L0.00390625 4.00654Z"
            fill="#2A62D3"
          />
          <path
            d="M6.14844 0.0273438V18.7821C7.53163 19.7102 9.0002 19.6276 10.7298 16.6391V4.24284L6.14844 0.0273438Z"
            fill="#2A62D3"
          />
          <path
            d="M10.7289 18.195V20.6587C10.7289 23.6108 8.32599 26.0016 5.36445 26.0016C2.40534 26.0016 0 23.6108 0 20.6587V15.7143C3.71047 15.0438 6.42074 25.642 10.7289 18.195Z"
            fill="#6B29D3"
          />
          <path
            d="M18.8555 21.0751V5.76562H25.6421C26.696 5.76562 27.5889 5.91627 28.3207 6.21512C29.0526 6.51397 29.6063 6.94402 29.9796 7.50528C30.3528 8.06653 30.5406 8.74199 30.5406 9.52921C30.5406 10.4039 30.3235 11.1401 29.8917 11.7378C29.4599 12.3355 28.833 12.7364 28.0133 12.9405L27.9694 12.525C28.6574 12.6708 29.255 12.9259 29.76 13.2903C30.265 13.6548 30.6577 14.1043 30.9358 14.6364C31.2139 15.1685 31.353 15.7711 31.353 16.4416C31.353 17.2143 31.2213 17.8897 30.9578 18.4656C30.6943 19.0414 30.3138 19.5273 29.8161 19.921C29.3185 20.3146 28.7354 20.6061 28.0694 20.7956C27.4035 20.9851 26.6667 21.0799 25.8617 21.0799H18.8555V21.0751ZM22.3708 11.9103H25.1152C25.4958 11.9103 25.8202 11.8495 26.0934 11.7232C26.3642 11.5993 26.5691 11.4244 26.7082 11.1984C26.8472 10.9724 26.9156 10.7003 26.9156 10.3772C26.9156 9.91066 26.7546 9.54378 26.4325 9.27166C26.1105 9.00197 25.6275 8.86591 24.9835 8.86591H22.3708V11.9103ZM22.3708 17.9699H25.73C26.1398 17.9699 26.4886 17.9043 26.7741 17.7731C27.0595 17.6419 27.2815 17.45 27.4449 17.1924C27.6059 16.9373 27.6864 16.6263 27.6864 16.2619C27.6864 15.9266 27.6011 15.6423 27.4327 15.409C27.2644 15.1758 27.0253 14.996 26.718 14.8721C26.4106 14.7482 26.0447 14.6874 25.6202 14.6874H22.3708V17.9699Z"
            fill="#ffffff"
          />
          <path
            d="M37.8503 21.3163C36.9867 21.3163 36.25 21.1292 35.6426 20.7575C35.0351 20.3857 34.5667 19.8488 34.2374 19.149C33.9081 18.4493 33.7422 17.611 33.7422 16.6343V9.45946H37.277V16.1532C37.277 16.6197 37.3502 17.0206 37.4966 17.3559C37.6429 17.6912 37.8625 17.9512 38.1552 18.1334C38.448 18.3156 38.7993 18.4055 39.2091 18.4055C39.5165 18.4055 39.7994 18.3545 40.0556 18.2525C40.3117 18.1504 40.5313 18.0095 40.7143 17.8249C40.8972 17.6426 41.0387 17.4312 41.1436 17.1907C41.2461 16.9502 41.2973 16.6853 41.2973 16.3913V9.45703H44.8321V21.0709H41.5169L41.3632 18.6874L42.0218 18.425C41.8462 18.9789 41.5535 19.4722 41.1436 19.9022C40.7338 20.3323 40.2434 20.6749 39.6726 20.93C39.1018 21.1875 38.4943 21.3163 37.8503 21.3163Z"
            fill="#ffffff"
          />
          <path
            d="M49.9305 7.1652C49.2718 7.1652 48.7546 7.0097 48.3814 6.69384C48.0082 6.38041 47.8203 5.93091 47.8203 5.34779C47.8203 4.82297 48.0106 4.39292 48.3912 4.05763C48.7717 3.72233 49.284 3.55469 49.928 3.55469C50.5867 3.55469 51.099 3.71262 51.4649 4.02605C51.8308 4.33947 52.0138 4.78167 52.0138 5.35022C52.0138 5.88961 51.826 6.32696 51.4527 6.66225C51.0844 6.99755 50.5745 7.1652 49.9305 7.1652ZM48.174 21.0751V9.46123H51.6869V21.0751H48.174Z"
            fill="#ffffff"
          />
          <path d="M55 21.0747V4.89062H58.5129V21.0747H55Z" fill="#ffffff" />
          <path
            d="M65.8489 21.3138C64.839 21.3138 63.9412 21.0562 63.1582 20.5363C62.3751 20.0188 61.7555 19.3044 61.3017 18.3933C60.848 17.4822 60.6211 16.4423 60.6211 15.276C60.6211 14.1098 60.848 13.0699 61.3017 12.1588C61.7555 11.2476 62.3775 10.5284 63.1679 10.0036C63.9583 9.47882 64.8658 9.2164 65.8904 9.2164C66.4173 9.2164 66.9223 9.2966 67.4053 9.45695C67.8883 9.61731 68.3274 9.83597 68.7226 10.113C69.1178 10.3899 69.4399 10.7082 69.6887 11.0654C69.9375 11.4226 70.0839 11.7919 70.1278 12.1709L69.2935 12.3677V4.88672H72.8283V21.0708H69.557L69.3594 18.4249L70.0619 18.5342C70.018 18.8987 69.8741 19.2486 69.6326 19.5839C69.3911 19.9192 69.0788 20.2156 68.6983 20.4707C68.3177 20.7258 67.881 20.9299 67.3907 21.083C66.9052 21.236 66.3905 21.3138 65.8489 21.3138ZM66.7491 18.4055C67.2907 18.4055 67.7591 18.2743 68.1542 18.0119C68.5494 17.7494 68.8544 17.385 69.0666 16.9185C69.2789 16.452 69.3862 15.9053 69.3862 15.2785C69.3862 14.637 69.2789 14.0831 69.0666 13.6166C68.8544 13.1501 68.5494 12.7856 68.1542 12.5232C67.7591 12.2608 67.2907 12.1296 66.7491 12.1296C66.2075 12.1296 65.7416 12.2608 65.3537 12.5232C64.9658 12.7856 64.6609 13.1501 64.4413 13.6166C64.2218 14.0831 64.112 14.637 64.112 15.2785C64.112 15.9053 64.2218 16.452 64.4413 16.9185C64.6609 17.385 64.9658 17.7494 65.3537 18.0119C65.7416 18.2743 66.2075 18.4055 66.7491 18.4055Z"
            fill="#ffffff"
          />
          <path
            d="M83.5273 21.0751V5.76562H85.2399V21.0751H83.5273ZM84.3836 7.42753V5.76562H93.1902V7.42753H84.3836ZM84.3836 14.2501V12.5663H92.1583V14.2501H84.3836Z"
            fill="#ffffff"
          />
          <path
            d="M100.633 21.2957C99.4909 21.2957 98.4761 21.0406 97.5906 20.5304C96.705 20.0201 96.0098 19.3131 95.5048 18.4093C94.9998 17.5054 94.7461 16.4777 94.7461 15.326C94.7461 14.1889 94.9998 13.1757 95.5048 12.2865C96.0098 11.3972 96.705 10.6975 97.5906 10.1872C98.4761 9.677 99.4909 9.42188 100.633 9.42188C101.76 9.42188 102.767 9.677 103.653 10.1872C104.538 10.6975 105.233 11.3972 105.738 12.2865C106.243 13.1757 106.497 14.1889 106.497 15.326C106.497 16.4777 106.243 17.5054 105.738 18.4093C105.233 19.3131 104.538 20.0201 103.653 20.5304C102.767 21.0406 101.76 21.2957 100.633 21.2957ZM100.633 19.7432C101.438 19.7432 102.155 19.5512 102.784 19.1625C103.414 18.7762 103.904 18.2513 104.255 17.588C104.607 16.9247 104.782 16.1715 104.782 15.3236C104.782 14.478 104.607 13.7273 104.255 13.0713C103.904 12.4152 103.414 11.9001 102.784 11.5284C102.155 11.1567 101.438 10.9696 100.633 10.9696C99.8276 10.9696 99.1055 11.1567 98.4688 11.5284C97.8321 11.9001 97.3344 12.4177 96.9758 13.081C96.6172 13.7443 96.444 14.4926 96.4586 15.3236C96.444 16.1691 96.6147 16.9247 96.9758 17.588C97.3344 18.2513 97.8321 18.7762 98.4688 19.1625C99.1079 19.5488 99.8276 19.7432 100.633 19.7432Z"
            fill="#ffffff"
          />
          <path
            d="M108.891 21.0756V9.6585H110.537L110.581 12.698L110.406 12.2826C110.567 11.7723 110.825 11.2985 111.186 10.8612C111.545 10.4239 111.972 10.074 112.472 9.81158C112.969 9.54917 113.518 9.41797 114.118 9.41797C114.367 9.41797 114.601 9.43742 114.821 9.47386C115.041 9.51031 115.224 9.55889 115.37 9.61477L114.909 11.4516C114.719 11.3641 114.523 11.3034 114.326 11.2645C114.128 11.2281 113.94 11.2086 113.767 11.2086C113.27 11.2086 112.823 11.2961 112.428 11.4711C112.033 11.646 111.696 11.8914 111.418 12.2048C111.14 12.5182 110.928 12.8803 110.781 13.2884C110.635 13.6966 110.562 14.134 110.562 14.6005V21.0756H108.891Z"
            fill="#ffffff"
          />
          <path
            d="M117.059 21.0742V9.65712H118.705L118.749 12.2593L118.42 12.3687C118.537 11.9313 118.73 11.5353 119.003 11.1757C119.274 10.8185 119.598 10.5075 119.979 10.2451C120.359 9.98271 120.776 9.78346 121.23 9.64254C121.684 9.50405 122.16 9.43603 122.657 9.43603C123.257 9.43603 123.796 9.53322 124.272 9.73002C124.748 9.92683 125.15 10.2621 125.48 10.7359C125.809 11.2097 126.063 11.8341 126.238 12.6068L125.843 12.41L125.997 12.0382C126.143 11.7029 126.36 11.3798 126.646 11.0639C126.931 10.7505 127.261 10.4711 127.634 10.2208C128.007 9.97298 128.417 9.78105 128.863 9.64013C129.31 9.50163 129.766 9.43359 130.237 9.43359C131.042 9.43359 131.722 9.6061 132.279 9.94868C132.835 10.2913 133.257 10.8137 133.542 11.5134C133.828 12.2131 133.972 13.1024 133.972 14.1812V21.0718H132.281V14.2687C132.281 13.5106 132.186 12.891 131.996 12.41C131.805 11.9289 131.522 11.5668 131.149 11.3263C130.776 11.0858 130.303 10.9667 129.732 10.9667C129.234 10.9667 128.775 11.0518 128.358 11.2194C127.941 11.3871 127.583 11.6203 127.283 11.9192C126.982 12.218 126.748 12.5582 126.58 12.9372C126.412 13.3162 126.326 13.7244 126.326 14.1618V21.0742H124.658V14.2492C124.658 13.5203 124.56 12.9153 124.362 12.4343C124.165 11.9532 123.875 11.5887 123.494 11.3409C123.113 11.0931 122.645 10.9692 122.089 10.9692C121.606 10.9692 121.159 11.0542 120.75 11.2218C120.34 11.3895 119.984 11.6203 119.683 11.9119C119.383 12.2034 119.149 12.5387 118.981 12.9178C118.813 13.2968 118.727 13.705 118.727 14.1423V21.0766H117.059V21.0742Z"
            fill="#ffffff"
          />
          <path
            d="M141.149 21.2944C140.27 21.2944 139.526 21.1146 138.919 20.7575C138.312 20.4003 137.85 19.8803 137.536 19.1927C137.221 18.5076 137.062 17.6548 137.062 16.6343V9.65625H138.731V16.3063C138.731 17.0789 138.836 17.7252 139.051 18.2427C139.263 18.7603 139.585 19.1514 140.017 19.4138C140.449 19.6762 140.98 19.8074 141.61 19.8074C142.093 19.8074 142.539 19.7248 142.949 19.5548C143.359 19.3871 143.717 19.1587 144.025 18.8647C144.332 18.5732 144.574 18.2306 144.749 17.837C144.925 17.4434 145.013 17.0279 145.013 16.5906V9.65625H146.659V21.0733H145.035L144.969 18.6679L145.232 18.5367C145.057 19.047 144.764 19.511 144.354 19.9265C143.944 20.342 143.456 20.6749 142.893 20.9227C142.329 21.1705 141.749 21.2944 141.149 21.2944Z"
            fill="#ffffff"
          />
          <path
            d="M149.91 21.0747V4.89062H151.557V21.0747H149.91Z"
            fill="#ffffff"
          />
          <path
            d="M159.067 21.2942C158.072 21.2942 157.172 21.0343 156.367 20.5167C155.562 19.9992 154.925 19.2922 154.456 18.3956C153.988 17.4991 153.754 16.4811 153.754 15.344C153.754 14.1923 153.995 13.1718 154.478 12.2826C154.961 11.3933 155.61 10.6936 156.423 10.1833C157.235 9.67309 158.147 9.41797 159.157 9.41797C159.758 9.41797 160.314 9.50544 160.826 9.68038C161.338 9.85532 161.794 10.1007 162.199 10.4141C162.602 10.7276 162.939 11.092 163.209 11.5075C163.48 11.923 163.668 12.3725 163.768 12.8535L163.285 12.613L163.351 9.66094H164.998V21.078H163.329V18.279L163.768 17.9947C163.666 18.4321 163.468 18.8524 163.175 19.2533C162.882 19.6542 162.526 20.009 162.109 20.3151C161.692 20.6212 161.224 20.8618 160.704 21.0367C160.182 21.2068 159.638 21.2942 159.067 21.2942ZM159.44 19.7198C160.201 19.7198 160.882 19.5352 161.482 19.161C162.082 18.7893 162.556 18.2717 162.9 17.6084C163.244 16.9451 163.417 16.1895 163.417 15.344C163.417 14.4984 163.244 13.7477 162.9 13.0916C162.556 12.4356 162.082 11.9181 161.482 11.5391C160.882 11.1601 160.201 10.9705 159.44 10.9705C158.665 10.9705 157.979 11.1601 157.386 11.5391C156.794 11.9181 156.325 12.4356 155.981 13.0916C155.637 13.7477 155.464 14.4984 155.464 15.344C155.464 16.1749 155.632 16.9233 155.969 17.5866C156.306 18.2499 156.774 18.7722 157.374 19.1513C157.977 19.5303 158.665 19.7198 159.44 19.7198Z"
            fill="#ffffff"
          />
        </g>
        <defs>
          <clipPath id="clip0_7311_369990">
            <rect width="165" height="26" fill="white" />
          </clipPath>
        </defs>
      </svg>
      <Card className="parallax-card">
        <CardContent className="card-content">
          <h2 className="title">Work Hours Calculator</h2>
          <label className="label-intime">
            Morning Check In Time <span className="asterisk">*</span>
          </label>
          <Input
            type="time"
            value={inTime}
            onChange={(e) => setInTime(e.target.value)}
            error={errors.inTime}
          />

          {breaks.map((b, i) => (
            <div key={i} className="break-row">
              <div className="break-input-pair">
                <div style={{ flex: 1 }}>
                  <label className="label">
                    Break {i + 1} Start <span className="asterisk">*</span>
                  </label>
                  <Input
                    type="time"
                    value={b.start}
                    onChange={(e) =>
                      handleBreakChange(i, "start", e.target.value)
                    }
                    error={errors[`break${i}_start`]}
                  />
                </div>
                <div style={{ flex: 1 }}>
                  <label className="label">
                    Break {i + 1} End <span className="asterisk">*</span>
                  </label>
                  <Input
                    type="time"
                    value={b.end}
                    onChange={(e) =>
                      handleBreakChange(i, "end", e.target.value)
                    }
                    error={errors[`break${i}_end`]}
                  />
                </div>
                {i === 0 ? (
                  <button onClick={addBreak} className="round-button add">
                    +
                  </button>
                ) : (
                  <button
                    onClick={() => removeBreak(i)}
                    className="round-button delete"
                  >
                    Ã—
                  </button>
                )}
              </div>
            </div>
          ))}
          <Button onClick={() => calculateEndTime()}>Calculate</Button>
          {result && <p className="result">{result}</p>}
        </CardContent>
      </Card>
    </div>
  );
}
